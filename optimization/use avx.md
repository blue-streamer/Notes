### 编译选项

如果要使用avx指令集优化的话在clang编译器中需要添加**-mavx**的编译选项，添加这个编译选项之后编译器会在编译源文件时添加相应的宏“\_\_AVX\_\_”

**注意：生成的所有汇编代码都会使用avx的指令集进行优化，并不是只有使用avx的simd或者汇编代码才会使用。比如赋值，memcpy等等**

所以，如果这个编译出来的代码运行在不支持avx的cpu上就会crash，0xC000001D: Illegal Instruction。

### 正确做法

对于使用了avx  simd或者汇编代码单独写在一个源文件中，不要和业务逻辑代码写在一起，单独指定这些源文件的编译选项。然后生成独立的库文件，暴露符号进行链接即可。在调用处使用cpuid来判断，这样就可以适配不同的cpu的指令集了。